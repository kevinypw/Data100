win <- as(cc_adm2_mtools, "owin")
cc_adm2_ppp <- rpoint(pop, f = as.im(cc_pop15), win = win)
# png("cc_points_2015.png", width = 2000, height = 2000)
# plot(win, main = NULL)
# plot(cc_adm2_ppp, cex = 0.15, add = TRUE)
# dev.off()
# bw <- bw.ppl(cc_adm2_ppp)
# save(bw, file="bw.RData")
load("bw.RData")
cc_density_image <- density.ppp(cc_adm2_ppp, sigma = bw)
Dsg <- as(cc_density_image, "SpatialGridDataFrame")  # convert to spatial grid class
Dim <- as.image.SpatialGridDataFrame(Dsg)  # convert again to an image
Dcl <- contourLines(Dim, levels = 9000000)  # create contour object
SLDF <- ContourLines2SLDF(Dcl, CRS("+proj=longlat +datum=WGS84 +no_defs"))
multiline_cc_sf <- st_as_sf(SLDF, sf)
# plot(cc_density_image, main="Population Density")
# plot(multiline_cc_sf, add=TRUE)
inside_polygons <- st_polygonize(multiline_cc_sf)
outside_lines <- st_difference(multiline_cc_sf, inside_polygons)
buffer_offset1 <- st_buffer(outside_lines, 0.001)
buffer_offset2 <- st_difference(cc, buffer_offset1)
buffer_offset3 <- st_cast(buffer_offset2, "POLYGON")
buffer_offset3$area <- as.numeric(st_area(buffer_offset3))
sub_polygons <- buffer_offset3 %>%
filter(area < 150000000)
plot(st_geometry(multiline_cc_sf))
plot(st_geometry(inside_polygons))
plot(st_geometry(outside_lines))
View(multiline_cc_sf)
plot(st_geometry(SLDF))
inside_polygons <- st_polygonize(SLDF)
inside_polygons <- st_polygonize(multiline_cc_sf)
outside_lines <- st_difference(multiline_cc_sf, inside_polygons)
buffer_offset1 <- st_buffer(outside_lines, 0.001)
buffer_offset2 <- st_difference(cc, buffer_offset1)
buffer_offset3 <- st_cast(buffer_offset2, "POLYGON")
buffer_offset3$area <- as.numeric(st_area(buffer_offset3))
sub_polygons <- buffer_offset3 %>%
filter(area < 150000000)
plot(st_geometry(sub_polygons))
plot(st_geometry(outside_lines))
rm(sub_polygons)
plot(st_geometry(buffer_offset3))
View(buffer_offset3)
sub_polygons <- buffer_offset3 %>%
filter(area < 35000000)
plot(st_geometry(sub_polygons))
sub_polygons <- buffer_offset3 %>%
filter(area < 50000000)
plot(st_geometry(sub_polygons))
sub_polygons <- sub_polygons %>%
filter(!(area=33965804.46))
plot(st_geometry(sub_polygons))
View(sub_polygons)
sub_polygons <- buffer_offset3 %>%
filter(area < 50000000)
sub_polygons <- sub_polygons %>%
filter(area > 1000000 && area < 34000000)
sub_polygons <- buffer_offset3 %>%
filter(area < 50000000)
sub_polygons <- sub_polygons %>%
filter(area < 1000000 & area > 34000000)
sub_polygons <- buffer_offset3 %>%
filter(area < 50000000)
View(sub_polygons)
sub_polygons[ -c(3) ]
sub_polygons <- sub_polygons[ -c(3) ]
plot(cc_density_image, main="Population Density")
plot(multiline_cc_sf, add=TRUE)
Dcl <- contourLines(Dim, levels = 8000000)  # create contour object
SLDF <- ContourLines2SLDF(Dcl, CRS("+proj=longlat +datum=WGS84 +no_defs"))
multiline_cc_sf <- st_as_sf(SLDF, sf)
plot(cc_density_image, main="Population Density")
plot(multiline_cc_sf, add=TRUE)
inside_polygons <- st_polygonize(multiline_cc_sf)
outside_lines <- st_difference(multiline_cc_sf, inside_polygons)
buffer_offset1 <- st_buffer(outside_lines, 0.001)
buffer_offset2 <- st_difference(cc, buffer_offset1)
buffer_offset3 <- st_cast(buffer_offset2, "POLYGON")
buffer_offset3$area <- as.numeric(st_area(buffer_offset3))
View(buffer_offset3)
plot(st_geometry(buffer_offset3))
plot(st_geometry(buffer_offset3))
sub_polygons <- buffer_offset3 %>%
filter(area < 50000000)
plot(st_geometry(sub_polygons))
sub_polygons <- buffer_offset3 %>%
filter(area < 60000000)
plot(st_geometry(sub_polygons))
sub_polygons <- sub_polygons[ -c(4), ]
plot(st_geometry(sub_polygons))
subpolys_extract <- raster::extract(cc_pop15, sub_polygons, df = TRUE)
subpolys_totals <- subpolys_extract %>%
group_by(ID) %>%
summarize(pop15 = sum(GTM_ppp_v2b_2015, na.rm = TRUE))
sub_polygons <- sub_polygons %>%
add_column(pop15 = subpolys_totals$pop15)
png("subpolys.png", width = 1200, height = 1200)
plot(cc_density_image, main = NULL)
plot(st_geometry(sub_polygons), add = TRUE)
dev.off()
subpolys_filtered <- sub_polygons %>%
filter(pop15 > 750)
png("subpolys_filtered.png", width = 1200, height = 1200)
plot(cc_density_image, main = NULL)
plot(st_geometry(subpolys_filtered), add = TRUE)
dev.off()
inside_polygons <- st_collection_extract(inside_polygons, "POLYGON")
ips_extract <- raster::extract(cc_pop15, inside_polygons, df = TRUE)
ips_totals <- ips_extract %>%
group_by(ID) %>%
summarize(pop15 = sum(GTM_ppp_v2b_2015, na.rm = TRUE))
inside_polygons <- inside_polygons %>%
add_column(pop15 = ips_totals$pop15)
inside_polys_filtered <- inside_polygons %>%
filter(pop15 > 150)
uas <- st_union(inside_polys_filtered, subpolys_filtered)
urban_areas <- st_cast(uas, "POLYGON")
urban_areas[ ,1:19] <- NULL
plot(cc_pop15, main = NULL)
plot(st_geometry(urban_areas), add = TRUE)
uas_extract <- raster::extract(cc_pop15, urban_areas, df = TRUE)
View(uas_extract)
uas_totals <- uas_extract %>%
group_by(ID) %>%
summarize(pop15 = sum(GTM_ppp_v2b_2015, na.rm = TRUE))
urban_areas <- urban_areas %>%
add_column(pop15 = uas_totals$pop15)
urban_areas
urban_areas %>%
unique()
urban_areas <- urban_areas %>%
unique()
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.45,
alpha = 0.5)
library(units)
View(urban_areas)
urban_areas <- urban_areas %>%
mutate(area = st_area(urban_areas) %>%
set_units(km^2)) %>%
mutate(density = as.numeric(pop15 / area))
ua_cntr_pts <-  urban_areas %>%
st_centroid() %>%
st_cast("MULTIPOINT")
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = 0.5,
color = "red"),
show.legend = 'point') +
scale_color_gradient(low = "purple", high = "yellow")
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15)
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5)
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = 0.5,
color = "red"),
show.legend = 'point')
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = 0.2,
color = "red"),
show.legend = 'point') +
scale_color_gradient2(low = muted("purple"), mid= "red", high = muted("yellow"))
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = 0.2,
color = "red"),
show.legend = 'point') +
scale_color_gradient2(low = "purple", mid= "red", high = "yellow")
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = 0.2,
color = "red"),
show.legend = 'point')
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = 0.001,
color = "red"),
show.legend = 'point')
View(ua_cntr_pts)
View(ua_cntr_pts)
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = density,
color = "red"),
show.legend = 'point') +
scale_color_gradient2(low = "purple", high = "red")
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "purple", high = "red")
ggplot() +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
names(ua_cntr_pts) = c("Population", "Area", "Density", "Geometry")
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = Population,
color = Density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
names(ua_cntr_pts) = c("Population", "Area", "Density", "Geometry")
ua_cntr_pts <-  urban_areas %>%
st_centroid() %>%
st_cast("MULTIPOINT")
proj5_final_plot <- ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = Population,
color = Density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
setwd("D:/programming/Data100/proj_dir/images")
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = Population,
color = Density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
ggsave("proj5_final_plot.png",
dpi = 800,
width = 5,
height = 5)
setwd("D:/programming/Data100/proj_dir/images")
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
ggsave("proj5_final_plot.png",
dpi = 800,
width = 5,
height = 5)
setwd("D:/programming/Data100/proj_dir/images")
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
ggsave("proj5_final_plot.png",
dpi = 800,
width = 5,
height = 5)
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red") +
theme(
axis.title.x = element_text(size = 20, face="bold"),
axis.text.x = element_text(size = 16),
axis.title.y = element_text(size = 16))
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red") +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12))
ggplot() +
ggtitle("Urbanized Population in Chichicastenango, Guatemala") +
xlab("Longitude") +
ylab("Latitude") +
geom_sf(data = cc,
size = 0.75,
color = "gray50",
fill = "gold3",
alpha = 0.15) +
geom_sf(data = urban_areas,
fill = "lightblue",
size = 0.25,
alpha = 0.5) +
geom_sf(data = ua_cntr_pts,
aes(size = pop15,
color = density),
show.legend = 'point') +
scale_color_gradient2(low = "yellow", high = "red")
ggsave("proj5_final_plot.png",
dpi = 800,
width = 5,
height = 5)
ggsave("proj5_final_plot.png",
dpi = 800,
width = 5,
height = 5,
units="in")
ggsave("proj5_final_plot.png",
dpi = 800,
width = 5,
height = 5,
scale = 2,
units="in")
ggsave("proj5_final_plot.png",
dpi = 800,
width = 5,
height = 5,
scale = 1.75,
units="in")
